<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Revistas CAPMEX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Catálogo de revistas CAPMEX — consulta ediciones por fecha o tema." />
  <link rel="stylesheet" href="assets/css/estilos-revdig.css">
  <link rel="stylesheet" href="assets/css/estilos.css">
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Revistas CAPMEX</h1>
      <div class="bar">
        <input id="q" type="search" placeholder="Buscar título o etiqueta…" />
        <select id="year"></select>
        <select id="sort">
          <option value="date-desc">Más recientes</option>
          <option value="date-asc">Más antiguas</option>
          <option value="title-asc">Título A–Z</option>
          <option value="title-desc">Título Z–A</option>
        </select>
      </div>
    </header>

    <div id="count" class="muted" style="margin-bottom:8px"></div>

    <section id="grid" class="grid" aria-live="polite"></section>
    <div id="empty" class="empty" hidden>No hay resultados con los filtros actuales.</div>

    <footer class="muted">Clic en una portada para abrir la revista.</footer>
    <footer style="text-align: center;">
      					<!-- copyright -->
					<div class="copyright text-center">
						<a href="index.html">
							<!-- <img src="images/logo-meghna.png" alt="Meghna" />  -->
							<svg width="80px" height="80px" viewBox="0 0 236.21 263.06" version="1.1"
								xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
								<path class="logo"
									d="M73.36.09C108.19-.03,143.02-.03,177.85.09l1.26.11c-1.06,1.45-2.12,2.9-3.17,4.36-28.87,40.29-57.73,80.59-86.59,120.89-5.08,7.09-10.09,14.23-15.3,21.22-4.28-6-8.59-11.99-12.88-17.99,6.23-8.66,12.37-17.39,18.63-26.03,7.84-10.93,15.67-21.85,23.48-32.79,11.63-16.22,23.25-32.44,34.86-48.68-26.62.05-53.25-.15-79.86.1,5-7.08,10.19-14.04,15.08-21.19M27.73,20.87c8.64-.07,17.27-.03,25.91-.04-2.68,3.79-5.4,7.56-8.1,11.34-7.2,10.12-14.49,20.18-21.7,30.29-1.76,2.48-3.51,4.96-5.26,7.43-1.17,1.61-2.35,3.21-3.53,4.81-4.32-5.99-8.61-12-12.9-18.02,3.9-5.55,7.83-11.09,11.83-16.58,3.06-4.22,6.04-8.5,9.08-12.73,1.59-2.15,3.15-4.31,4.67-6.5M185.16,21.41l.08-.66c7.2.11,14.41.07,21.61.07h3.67c8.62,11.9,17.14,23.87,25.69,35.82-1.58,2.22-3.15,4.42-4.72,6.64-2.69,3.81-5.45,7.58-8.17,11.37-2.16-2.73-4.17-5.56-6.16-8.41-10.54-15.03-21.42-29.83-32-44.83M0,96.55c1.6-.05,3.19-.12,4.79-.11,4.76.03,9.52,0,14.27,0,2.29.01,4.57.03,6.86.1,14.52,20.63,29.4,41.02,43.98,61.62l.76,1.04c1.2,1.65,2.4,3.3,3.61,4.95,2.4-3.34,4.82-6.67,7.14-10.08,3.34-4.57,6.67-9.15,9.92-13.79,2.03-2.75,4.01-5.54,6.01-8.31,8.43-11.83,16.96-23.59,25.33-35.45,8.64-.03,17.29-.04,25.94-.02-2.39,3.29-4.75,6.59-7.11,9.9-5.05,7.06-10.06,14.15-15.17,21.16-2.39,3.37-4.82,6.72-7.15,10.13-3.49,4.83-7,9.66-10.46,14.51-7.1,9.77-14.07,19.66-21.12,29.48-1.8,2.51-3.54,5.06-5.39,7.54-1.56,2.07-3.05,4.2-4.52,6.33-1.14,1.62-2.34,3.21-3.55,4.77-2.42-3.63-5.05-7.13-7.55-10.72-2.11-2.97-4.24-5.93-6.38-8.87-2.41-3.33-4.77-6.68-7.15-10.02-8.68-12.05-17.28-24.15-25.94-36.21-8.52-11.67-16.77-23.54-25.28-35.22-.62-.91-1.23-1.82-1.84-2.74M130.66,138.83c1.67,0,3.34,0,5.01,0,5.52-.02,11.03-.02,16.54-.02,3.03,0,6.07.03,9.1,0,2.01-.02,4.02-.03,6.03-.02,1.99,0,3.98,0,5.98,0,11.63.07,23.26-.03,34.89-.03-3.5,5.01-7.11,9.93-10.62,14.93l-.56.74c-2.34,3.15-4.59,6.36-6.85,9.56-5.66,7.96-11.4,15.86-17.06,23.82-5.24,7.26-10.43,14.56-15.65,21.83-3.69,5.22-7.44,10.4-11.14,15.62-8.65,12.12-17.38,24.19-26,36.34-.32.36-.96,1.08-1.28,1.44-.69-.98-1.38-1.95-2.06-2.93-1.9-2.79-3.9-5.52-5.91-8.24-2.79-3.83-5.5-7.73-8.27-11.58-5.37-7.54-10.8-15.03-16.14-22.59-2.02-2.93-4.13-5.81-6.24-8.68,2.12-3.27,4.48-6.35,6.75-9.5,1.05-1.46,2.08-2.93,3.13-4.39.7-.98,1.4-1.97,2.1-2.96.22-.34.67-1.03.89-1.38,1.38,1.85,2.73,3.73,4.07,5.61,1.89,2.64,3.8,5.28,5.67,7.95.67.95,1.35,1.9,2.03,2.86,1.57,2.23,3.13,4.46,4.71,6.69,3.08,4.36,6.26,8.66,9.36,13,5.76-7.86,11.43-15.78,17.04-23.74.24-.32.72-.95.96-1.27,1.26-1.69,2.51-3.4,3.71-5.14l.44-.66c1.98-2.83,4.03-5.61,6.08-8.39,6.73-9.35,13.34-18.78,20.11-28.09-4.8,0-9.6-.02-14.4.04-4.83-.03-9.67-.05-14.5-.02-1.17,0-2.33.02-3.49.03-6.42-.08-12.84,0-19.26-.08,2.29-3.34,4.71-6.6,7.01-9.94,2.62-3.61,5.18-7.25,7.82-10.83h0Z" />
							</svg>
						</a>

						<p class="mt-3">Copyright
							&copy;
							<script>
								document.write(new Date().getFullYear())
							</script>. Todos los derechos reservados. <br> Diseñado &amp; Creado por <a href="#">Nodeva</a>.
						</p>
					</div>
					<!-- /copyright -->
    </footer>
  </div>

  <script>
    // Config
    const DATA_URL   = 'revistas.json';      // el mismo que actualiza tu admin
    const VIEWER_URL = 'flipbook2.html';     // visor existente

    // Estado/refs
    let data = [], filtered = [];
    const $grid = document.getElementById('grid');
    const $empty = document.getElementById('empty');
    const $count = document.getElementById('count');
    const $q = document.getElementById('q');
    const $year = document.getElementById('year');
    const $sort = document.getElementById('sort');

    (async function init(){
      await fetchData();
      const years = [...new Set(data.map(d => new Date(d.fecha).getFullYear()))].sort((a,b)=>b-a);
      $year.innerHTML = `<option value="">Todos los años</option>` + years.map(y=>`<option>${y}</option>`).join('');

      // Estado desde URL (para compartir filtros)
      const sp = new URLSearchParams(location.search);
      $q.value = sp.get('q') || '';
      $year.value = sp.get('year') || '';
      $sort.value = sp.get('sort') || 'date-desc';

      apply();
      $q.addEventListener('input', apply);
      $year.addEventListener('change', apply);
      $sort.addEventListener('change', apply);
    })();

    async function fetchData(){
      try{
        const res = await fetch('revistas.json', { cache: 'no-store' });
        data = await res.json();
      }catch(e){ console.error('No se pudo leer revistas.json', e); data = []; }
    }

    function apply(){
      const q = $q.value.trim().toLowerCase();
      const y = $year.value;
      const s = $sort.value;

      filtered = data.filter(r=>{
        const matchesQ = !q || r.titulo.toLowerCase().includes(q) || (r.tags||[]).some(t=>t.toLowerCase().includes(q));
        const matchesY = !y || new Date(r.fecha).getFullYear().toString() === y;
        return matchesQ && matchesY;
      });

      filtered.sort((a,b)=>{
        if (s==="date-desc") return new Date(b.fecha)-new Date(a.fecha);
        if (s==="date-asc")  return new Date(a.fecha)-new Date(b.fecha);
        if (s==="title-asc") return a.titulo.localeCompare(b.titulo,'es');
        if (s==="title-desc")return b.titulo.localeCompare(a.titulo,'es');
        return 0;
      });

      // Actualiza URL (para compartir resultados)
      const sp = new URLSearchParams();
      if ($q.value) sp.set('q',$q.value);
      if ($year.value) sp.set('year',$year.value);
      if ($sort.value!=='date-desc') sp.set('sort',$sort.value);
      history.replaceState({}, '', location.pathname + (sp.toString()?`?${sp.toString()}`:''));

      render();
    }

    function render(){
      $grid.innerHTML='';
      if (!filtered.length){ $empty.hidden=false; $count.textContent='0 resultados'; return; }
      $empty.hidden=true; $count.textContent = `${filtered.length} resultado${filtered.length>1?'s':''}`;

      for (const r of filtered){
        const a = document.createElement('a');
        a.className='card';
        a.href = `${VIEWER_URL}?doc=${encodeURIComponent(r.pdf)}&title=${encodeURIComponent(r.titulo)}`;
        a.target='_blank'; a.rel='noopener';

        const th = document.createElement('div'); th.className='thumb';
        const img = document.createElement('img');
        img.loading='lazy'; img.decoding='async'; img.alt=r.titulo; img.src=r.cover;
        th.appendChild(img);

        const meta = document.createElement('div'); meta.className='meta';
        const h3 = document.createElement('div'); h3.className='title'; h3.textContent=r.titulo;
        const sub = document.createElement('div'); sub.className='sub';
        const d = new Date(r.fecha); sub.textContent = d.toLocaleDateString('es-MX',{year:'numeric', month:'short'});
        const tags = document.createElement('div'); tags.className='tags';
        (r.tags||[]).forEach(t=>{ const s=document.createElement('span'); s.className='tag'; s.textContent=t; tags.appendChild(s); });

        meta.appendChild(h3); meta.appendChild(sub); if((r.tags||[]).length) meta.appendChild(tags);

        a.appendChild(th); a.appendChild(meta);
        $grid.appendChild(a);
      }
    }
  </script>
</body>
</html>
